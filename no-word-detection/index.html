<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>New Tab</title>
<style>
:root{--tile-size:70px;}
html,body{height:100%;margin:0;}
body{
  font-family:"Arial Black", Arial, sans-serif;
  display:flex; flex-direction:column; align-items:center;
  min-height:100vh; color:white; overflow-x:hidden;
  background: linear-gradient(135deg, #004B4B 0%, #6A2C8C 33%, #00AFAF 66%, #6A2C8C 100%);
  background-size: 300% 300%; animation: gradientShift 24s ease-in-out infinite;
}
@keyframes gradientShift{
  0%{background-position:0% 50%;}
  33%{background-position:50% 50%;}
  66%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}
h1 { margin:20px; font-size:2.4rem; letter-spacing:3px; text-shadow:2px 2px 12px rgba(0,0,0,0.7);}
#board { display:grid; grid-template-rows: repeat(6, 1fr); gap:12px; perspective:1000px; margin-bottom:12px; position: relative; z-index:1; }
.row { display:grid; grid-template-columns: repeat(5, 1fr); gap:12px; }
.tile { width:var(--tile-size); height:var(--tile-size); background:#333; display:flex; justify-content:center; align-items:center; font-size:30px; font-weight:bold; border-radius:12px; perspective:1000px; box-shadow:0 0 5px rgba(0,0,0,0.6); transition: transform 0.2s; }
.tile.keypress { transform: scale(1.15); }
.tile.pop { transform: scale(1.06); }
.inner { width:100%; height:100%; display:flex; justify-content:center; align-items:center; background:#333; border-radius:12px; transform-style:preserve-3d; transition: transform 0.62s cubic-bezier(.2,.9,.3,1), background 0.2s, box-shadow 0.2s; }
.inner.correct { background: #2ea44f; }
.inner.present { background: #c9b458; }
.inner.absent  { background: #5f6368; }
.inner.glow-correct { box-shadow:0 0 22px rgba(46,164,79,0.9); }
.inner.glow-present { box-shadow:0 0 22px rgba(201,180,88,0.95); }
.inner.glow-absent { box-shadow:0 0 14px rgba(95,99,104,0.9); }
.flipping { transform: rotateX(180deg); }
.letter { backface-visibility:hidden; transform: rotateX(0deg); user-select:none; }
#controls { margin-top:8px; margin-bottom:10px; z-index:1; }
#controls button { margin:6px; padding:10px 20px; border-radius:10px; border:none; font-weight:bold; background: rgba(0,0,0,0.35); color:white; cursor:pointer; transition: transform .18s, box-shadow .18s, background .18s; text-shadow: 1px 1px 3px rgba(0,0,0,0.6); }
#controls button:hover { transform: translateY(-3px) scale(1.03); box-shadow:0 0 18px rgba(255,255,255,0.12); background: rgba(255,255,255,0.06); }
#keyboard { margin-top:12px; display:flex; flex-direction:column; align-items:center; gap:6px; z-index:1; position:relative; }
.kb-row { display:flex; gap:6px; justify-content:center; }
.kb-row button { padding:10px 12px; border-radius:6px; border:none; background:#444; color:white; font-weight:bold; cursor:pointer; transition: transform .12s, box-shadow .12s, background .12s; }
.kb-row button:hover { transform: scale(1.06); box-shadow:0 0 12px rgba(255,255,255,0.08); background:#666; }
.kb-row button.wide { min-width:90px; padding-left:18px; padding-right:18px; }
.kb-row button.correct { background:#2ea44f !important; color:white; }
.kb-row button.present { background:#c9b458 !important; color:white; }
.kb-row button.absent { background:#5f6368 !important; color:white; }

@keyframes shakeScreen {0%{transform:translate(0,0) scale(1);}12%{transform:translate(-12px,8px) scale(1.02);}24%{transform:translate(10px,-8px) scale(0.98);}36%{transform:translate(-8px,8px) scale(1.01);}48%{transform:translate(10px,-8px) scale(1.03);}60%{transform:translate(-6px,6px) scale(0.97);}72%{transform:translate(6px,-6px) scale(1.02);}84%{transform:translate(-4px,4px) scale(1.01);}100%{transform:translate(0,0) scale(1);}}
.shakeBody { animation: shakeScreen 1200ms ease-in-out both; }

.fallPiece { position:absolute; will-change: transform, opacity; pointer-events:none; animation: fallDown 1600ms cubic-bezier(.2,.7,.3,1) forwards; z-index:9999; }
@keyframes fallDown {0%{opacity:1; transform:translateY(0) rotate(0deg) scale(1);}100%{opacity:0; transform:translateY(900px) rotate(720deg) scale(.8);}}
.particle { position:absolute; border-radius:50%; pointer-events:none; will-change: transform, opacity; z-index:9999;}

#codePopup { position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); background: rgba(0,0,0,0.86); padding:22px; border-radius:12px; display:none; flex-direction:column; gap:10px; align-items:center; z-index:3000; box-shadow:0 0 30px rgba(0,0,0,0.6); }
#codePopup input { width:360px; max-width:86vw; padding:10px 12px; font-size:16px; border-radius:8px; border:none; }
#codePopup .codeRow { display:flex; gap:8px; }

#overlayBlock { position:fixed; left:0; top:0; right:0; bottom:0; background: rgba(0,0,0,0.4); display:none; z-index:2900; }

.centerMessage { position:fixed; left:50%; top:10%; transform:translateX(-50%); padding:14px 22px; background:rgba(0,0,0,0.7); border-radius:10px; font-size:20px; z-index:4000; box-shadow:0 0 22px rgba(255,255,255,0.08); transition:opacity .25s ease, transform .25s ease; }

@media (max-width:600px){ :root{ --tile-size:56px; } .letter{ font-size:20px; } }
</style>
</head>
<body>
<h1>Infinite Wordle</h1>

<div id="board"></div>

<div id="controls">
  <button id="newWordBtn">New Word</button>
  <button id="giveUpBtn">Give Up</button>
</div>

<div id="keyboard"></div>

<div id="overlayBlock" onclick="closeCodePopup()"></div>
<div id="codePopup">
  <div style="font-weight:bold">Enter Code</div>
  <input id="codeInput" type="text" placeholder="Type your code here" />
  <div class="codeRow">
    <button id="codeSubmitBtn">Submit</button>
    <button onclick="closeCodePopup()">Cancel</button>
  </div>
</div>

<script>
// ---------------------- data & state ----------------------
let WORDS = [];               // will hold UPPERCASE words
let solution = "";            // UPPERCASE solution
let board, keyboard;
let currentRow = 0, currentCol = 0;
let inputLocked = false;
const SECRET_CODE = "JiMmYiStHeCoOlEsTgUy|2025.letmecheat|L^UP++0U+L0UD";

// Try to load target_words.txt first (solutions). If fail, fall back
fetch("target_words.txt")
  .then(r => r.text())
  .then(txt => {
    WORDS = txt.split(/\r?\n/).map(w=>w.trim()).filter(w=>w.length===5).map(w=>w.toUpperCase());
    if(WORDS.length === 0) throw new Error("No 5-letter words found in target_words.txt");
    solution = WORDS[Math.floor(Math.random()*WORDS.length)];
    init();
  })
  .catch(err=>{
    // fallback small set
    WORDS = ["APPLE","GRAPE","WATER","LIGHT","HOUSE","PLANT","STONE","SMILE","MUSIC","TRAIN"];
    solution = WORDS[Math.floor(Math.random()*WORDS.length)];
    init();
  });

// Load words.txt as the allowed guesses (dictionary)
// NOTE: This list may be bigger and is only for validation
fetch("words.txt")
  .then(r => r.text())
  .then(txt => {
    GUESS_WORDS = txt.split(/\r?\n/).map(w=>w.trim()).filter(w=>w.length===5).map(w=>w.toUpperCase());
  });

// ---------------------- init ----------------------
function init(){
  board = document.getElementById("board");
  keyboard = document.getElementById("keyboard");
  buildBoard();
  createKeyboard();
  document.addEventListener("keydown", handleKeyInput);
  document.getElementById("newWordBtn").onclick = ()=>location.reload();
  document.getElementById("giveUpBtn").onclick = ()=>{ alert("Word was: "+solution); location.reload(); };
  document.getElementById("codeSubmitBtn").onclick = checkCode;
}

// ---------------------- UI builders ----------------------
function buildBoard(){
  board.innerHTML = "";
  for(let r=0;r<6;r++){
    const row = document.createElement("div"); row.className="row";
    for(let c=0;c<5;c++){
      const tile = document.createElement("div"); tile.className="tile";
      const inner = document.createElement("div"); inner.className="inner";
      const letter = document.createElement("div"); letter.className="letter";
      inner.appendChild(letter); tile.appendChild(inner); row.appendChild(tile);
    }
    board.appendChild(row);
  }
}

// Create keyboard (buttons store a numeric 'data-state' to control upgrades)
function createKeyboard(){
  const rows = ["QWERTYUIOP","ASDFGHJKL","ZXCVBNM"];
  keyboard.innerHTML = "";
  rows.forEach(r=>{
    const rowDiv = document.createElement("div"); rowDiv.className="kb-row";
    for(let ch of r){
      const btn = document.createElement("button"); btn.textContent = ch;
      btn.dataset.state = "0"; // 0=black,1=absent(gray),2=present(yellow),3=correct(green)
      btn.onclick = ()=>handleKeyInput({key: ch});
      rowDiv.appendChild(btn);
    }
    keyboard.appendChild(rowDiv);
  });
  const lastRow = document.createElement("div"); lastRow.className="kb-row";
  const enterBtn = document.createElement("button"); enterBtn.textContent="Enter"; enterBtn.className="wide"; enterBtn.onclick = ()=>handleKeyInput({key:"Enter"});
  const backBtn  = document.createElement("button"); backBtn.textContent="Backspace"; backBtn.className="wide"; backBtn.onclick = ()=>handleKeyInput({key:"Backspace"});
  lastRow.appendChild(enterBtn); lastRow.appendChild(backBtn);
  keyboard.appendChild(lastRow);
}

// ---------------------- helpers ----------------------
function getTile(r,c){ return board.children[r].children[c]; }

function showMessage(text, duration = 800){
  const m = document.createElement("div"); m.className="centerMessage"; m.textContent = text;
  document.body.appendChild(m);
  setTimeout(()=>{ m.style.opacity = "0"; m.style.transform = "translateY(-10px)"; }, duration);
  setTimeout(()=>m.remove(), duration+300);
}

// ---------------------- input handling ----------------------
function handleKeyInput(e){
  if(inputLocked) return;
  // Normalize key: single letter -> uppercase, else keep as is ("Enter","Backspace")
  const key = (typeof e.key === "string" && e.key.length === 1) ? e.key.toUpperCase() : e.key;
  if(/^[A-Z]$/.test(key) && currentCol < 5){
    const tile = getTile(currentRow, currentCol);
    tile.querySelector(".letter").textContent = key;
    tile.classList.add("keypress"); setTimeout(()=>tile.classList.remove("keypress"),180);
    currentCol++;
    return;
  }
  if(key === "Backspace" && currentCol > 0){
    currentCol--;
    getTile(currentRow, currentCol).querySelector(".letter").textContent = "";
    return;
  }
  if(key === "Enter" && currentCol === 5){
    submitRow();
    return;
  }
}

// ---------------------- main logic: submit & mark ----------------------
function submitRow(){
  // Build guess as UPPERCASE string
  let guess = "";
  for(let c=0;c<5;c++){
    const ch = getTile(currentRow,c).querySelector(".letter").textContent || "";
    guess += ch.toUpperCase();
  }

  if(guess.length < 5) return;

  inputLocked = true;

  // Prepare arrays for marking
  let solutionLetters = solution.split(""); // already UPPERCASE
  const colors = Array(5).fill("absent");

  // PASS 1 - mark correct (green)
  for(let i=0;i<5;i++){
    if(guess[i] === solutionLetters[i]){
      colors[i] = "correct";
      solutionLetters[i] = null; // consume
    }
  }

  // PASS 2 - mark present (yellow) using remaining letters
  for(let i=0;i<5;i++){
    if(colors[i] === "correct") continue;
    const idx = solutionLetters.indexOf(guess[i]);
    if(idx !== -1){
      colors[i] = "present";
      solutionLetters[idx] = null; // consume
    }
  }

  // Animate flips and apply classes, keyboard updates
  [...guess].forEach((ch, idx) => {
    setTimeout(()=>{
      const inner = getTile(currentRow, idx).querySelector(".inner");
      inner.classList.add("flipping");
      setTimeout(()=>{
        inner.classList.add(colors[idx]);
        inner.classList.remove("flipping");
        inner.classList.add(`glow-${colors[idx]}`);
        // update keyboard with precedence logic
        updateKeyboard(ch, colors[idx]);
        // small confetti per tile
        createConfetti(inner);
        setTimeout(()=>inner.classList.remove(`glow-${colors[idx]}`), 600);

        if(idx === 4){
          inputLocked = false;
          if(guess === solution){
            showMessage("You guessed it!", 1400);
            triggerVictorySequence();
          } else {
            currentRow++;
            currentCol = 0;
            if(currentRow === 6) showMessage("Out of tries! Word was "+solution, 1600);
          }
        }
      }, 320);
    }, idx * 380);
  });
}

// ---------------------- keyboard color precedence ----------------------
function updateKeyboard(letter, color){
  // color: "absent" | "present" | "correct"
  const priority = { "absent": 1, "present": 2, "correct": 3 };
  const btns = keyboard.querySelectorAll("button");
  btns.forEach(b=>{
    if(b.textContent.length !== 1) return; // ignore Enter/Backspace
    if(b.textContent.toUpperCase() !== letter) return;
    const cur = parseInt(b.dataset.state || "0", 10);
    const next = priority[color] || 0;
    if(next > cur){
      b.dataset.state = String(next);
      b.classList.remove("absent","present","correct");
      if(color === "absent") b.classList.add("absent");
      if(color === "present") b.classList.add("present");
      if(color === "correct") b.classList.add("correct");
    }
  });
}

// ---------------------- confetti, particles, victory ----------------------
function createConfetti(innerEl){
  const rect = innerEl.getBoundingClientRect();
  for(let i=0;i<6;i++){
    const p = document.createElement("div"); p.className="particle";
    const s = Math.random()*8+6;
    p.style.width = s + "px"; p.style.height = s + "px";
    // color based on inner classes
    let bg = "#777";
    if(innerEl.classList.contains("correct")) bg = "hsl(120,70%,45%)";
    else if(innerEl.classList.contains("present")) bg = "hsl(48,80%,45%)";
    else bg = "hsl(0,0%,37%)";
    p.style.background = bg;
    p.style.left = (rect.left + rect.width/2) + "px";
    p.style.top = (rect.top + rect.height/2) + "px";
    document.body.appendChild(p);
    const dx = (Math.random()-0.5)*260;
    const dy = -Math.random()*200 - 40;
    p.animate([{transform:`translate(0,0)`, opacity:1},{transform:`translate(${dx}px,${dy}px)`, opacity:0}],{duration:800+Math.random()*400, easing:"cubic-bezier(.2,.7,.3,1)", fill:"forwards"});
    setTimeout(()=>p.remove(),1200);
  }
}

function triggerVictorySequence(){
  document.body.classList.add("shakeBody");
  pulseBoardGlow();
  shatterBoard();
  spawnConfettiRain(120, 0, 0, window.innerWidth);
  spawnFloatingLetters(30, 0, 0, window.innerWidth, window.innerHeight);
  spawnSparkParticles(80, window.innerWidth/2, window.innerHeight/2);
  setTimeout(()=>location.reload(),2400);
}

function pulseBoardGlow(){
  board.querySelectorAll(".tile").forEach(t=>{ t.classList.add("pop"); setTimeout(()=>t.classList.remove("pop"),900); });
  keyboard.querySelectorAll("button").forEach(b=>{ b.style.boxShadow="0 0 22px rgba(46,255,87,0.95)"; setTimeout(()=>b.style.boxShadow="",900); });
}

function shatterBoard(){
  const pieces = [];
  board.querySelectorAll(".tile").forEach(t=>{
    const rect = t.getBoundingClientRect();
    const clone = t.cloneNode(true);
    clone.className = "fallPiece";
    clone.style.left = rect.left + "px";
    clone.style.top  = rect.top  + "px";
    clone.style.width = rect.width + "px";
    clone.style.height= rect.height + "px";
    document.body.appendChild(clone);
    pieces.push(clone);
  });
  setTimeout(()=>pieces.forEach(p=>p.remove()),1800);
}

function spawnConfettiRain(count,x,y,width){
  for(let i=0;i<count;i++){
    const p = document.createElement("div"); p.className="particle";
    const s = Math.random()*10+6;
    p.style.width = s+"px"; p.style.height = s+"px";
    p.style.background = `hsl(${Math.random()*360},100%,65%)`;
    p.style.left = (x + Math.random()*width) + "px";
    p.style.top = y + "px";
    document.body.appendChild(p);
    p.animate([{transform:`translateY(${600+Math.random()*200}px)`, opacity:0}],{duration:1200+Math.random()*800, easing:"cubic-bezier(.2,.7,.3,1)"});
    setTimeout(()=>p.remove(),1700);
  }
}

function spawnFloatingLetters(count,x,y,w,h){
  for(let i=0;i<count;i++){
    const l = document.createElement("div");
    const word = WORDS[Math.floor(Math.random()*WORDS.length)] || "WORD";
    l.textContent = word[Math.floor(Math.random()*5)] || "A";
    l.style.position="absolute"; l.style.color="white"; l.style.fontWeight="bold"; l.style.fontSize="22px";
    l.style.left = (x + Math.random()*w) + "px"; l.style.top = (y + Math.random()*h) + "px";
    document.body.appendChild(l);
    const duration = 1200 + Math.random()*600;
    l.animate([{transform:`translateY(0)`, opacity:1}, {transform:`translateY(-${150+Math.random()*120}px)`, opacity:0}], {duration, easing:"ease-out"});
    setTimeout(()=>l.remove(), duration);
  }
}

function spawnSparkParticles(count,x,y){
  for(let i=0;i<count;i++){
    const p = document.createElement("div"); p.className="particle";
    const size = Math.random()*6+3;
    p.style.width = size+"px"; p.style.height = size+"px";
    p.style.background = "rgba(46,255,87,"+(Math.random()*0.8+0.2)+")";
    p.style.left = x + "px"; p.style.top = y + "px";
    document.body.appendChild(p);
    const animTime = 600 + Math.random()*800;
    const dx = (Math.random()-0.5)*400;
    const dy = (Math.random()-0.5)*400;
    p.animate([{transform:`translate(0,0)`, opacity:1},{transform:`translate(${dx}px,${dy}px) scale(.3)`, opacity:0}],{duration:animTime, easing:"ease-out"});
    setTimeout(()=>p.remove(), animTime+50);
  }
}

// ---------------------- secret code popup ----------------------
function showCodePopup(){ document.getElementById("overlayBlock").style.display="block"; document.getElementById("codePopup").style.display="flex"; document.getElementById("codeInput").value=""; }
function closeCodePopup(){ document.getElementById("overlayBlock").style.display="none"; document.getElementById("codePopup").style.display="none"; }
function checkCode(){
  const val = document.getElementById("codeInput").value;
  if(val === SECRET_CODE){ alert("The word is: " + solution); closeCodePopup(); }
  else { alert("Wrong code!"); }
}
document.addEventListener("keydown", e=>{ if(e.ctrlKey && e.shiftKey && e.key.toUpperCase()==="A") showCodePopup(); });

</script>
</body>
</html>
